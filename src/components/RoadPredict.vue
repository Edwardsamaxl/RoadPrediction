<template>
  <div class="road-predict">
    <div class="search-box origin">
      <el-input v-model="origin" clearable placeholder="出发地" />
      <el-icon><Search /></el-icon>
    </div>
    <div class="search-box destination">
      <el-input v-model="destination" clearable placeholder="目的地" />
      <el-icon><Search /></el-icon>
    </div>
    <div class="time-selection">
      <span class="input-label">选择时间：</span>
      <el-select v-model="selectedTime" placeholder="选择时间" class="time-select">
        <el-option label="15分钟" value="15"></el-option>
        <el-option label="30分钟" value="30"></el-option>
        <el-option label="45分钟" value="45"></el-option>
        <el-option label="60分钟" value="60"></el-option>
      </el-select>
    </div>
    <div id="mapContainer" class="map-container"></div>

    <div class="input-card">
      <h4>轨迹回放控制</h4>
      <div class="input-item">
        <input type="button" class="btn" value="开始动画" @click="startAnimation"/>
        <input type="button" class="btn" value="暂停动画" @click="pauseAnimation"/>
      </div>
      <div class="input-item">
        <input type="button" class="btn" value="继续动画" @click="resumeAnimation"/>
        <input type="button" class="btn" value="停止动画" @click="stopAnimation"/>
      </div>
    </div>

<div v-if="showRoutes" class="routes-container">
  <el-card class="route-card" shadow="hover">
    <template #header>
      <div class="header-content">
        <span>规划路线</span>
        <el-button type="text" @click="minimizeRoutes">最小化</el-button>
      </div>
    </template>
    <el-radio-group v-model="selectedRoute" class="route-options">
      <el-radio :label="1">路线一：这是一条路线</el-radio>
      <el-radio :label="2">路线二：这是一条路线</el-radio>
      <el-radio :label="3">路线三：这是一条路线</el-radio>
    </el-radio-group>
    <div style="margin-top: 20px;">
      <el-button type="primary" @click="startJourney">出发</el-button>
    </div>
  </el-card>
</div>

<el-button v-if="!showRoutes" @click="maximizeRoutes" class="minimized-button" style="position: absolute; bottom: 20px; left: 20px;">
  展开
</el-button>
  </div>
</template>
<script>
import { onMounted, ref } from 'vue'
import AMapLoader from '@amap/amap-jsapi-loader'
import { Search } from '@element-plus/icons-vue'
import { ElButton, ElCard, ElRadio, ElRadioGroup, ElInput, ElIcon, ElSelect, ElOption } from 'element-plus'

export default {
  name: 'RoadPredict',
  components: {
    Search,
    ElButton,
    ElCard,
    ElRadio,
    ElRadioGroup,
    ElInput,
    ElIcon,
    ElSelect,
    ElOption
  },
  setup() {
    const origin = ref('')
    const destination = ref('')
    const selectedTime = ref(null)
    const selectedRoute = ref(1)
    const showRoutes = ref(false)

    // 地图轨迹添加
    let map = null
    let marker = null
    let passedPolyline = null
    const lineArr = [[116.3055280000001,39.98676300000005],[116.305603,39.98622600000004],[116.30564600000002,39.98597500000005],[116.30566800000008,39.985690000000034],[116.30568900000002,39.985443000000025],[116.30586600000004,39.98546500000003],[116.30626300000004,39.98548100000004],[116.30829600000004,39.98556100000007],[116.3089030000001,39.98554000000007],[116.30952000000002,39.98550800000004],[116.31036100000004,39.98552900000004],[116.31184800000004,39.98558300000007],[116.311955,39.985588000000064],[116.31257700000003,39.98559900000004],[116.31273800000008,39.98559900000004],[116.313661,39.98562600000003],[116.31612800000002,39.98571100000004],[116.31645000000005,39.98523400000005],[116.316504,39.984725000000026],[116.31653100000008,39.98445100000003],[116.31668600000012,39.98257300000005],[116.31673500000012,39.98181700000003],[116.31679900000006,39.98101800000006],[116.316815,39.980830000000026],[116.316815,39.98080300000004],[116.31683100000008,39.98059400000005],[116.31697600000008,39.97924700000004],[116.31699200000004,39.97907000000004],[116.31701300000007,39.97884500000004],[116.31701900000007,39.97877000000005],[116.31703000000006,39.978550000000034],[116.31712600000004,39.977686000000055],[116.31716900000004,39.97747700000007],[116.31731900000008,39.97708600000004],[116.31743700000004,39.97657600000008],[116.31752800000004,39.976302000000025],[116.31757700000004,39.97614100000004],[116.3176360000001,39.97597000000007],[116.31773200000003,39.97573900000003],[116.3182310000001,39.97452100000004],[116.31852100000005,39.97384000000005],[116.31870900000004,39.97339500000004],[116.31897700000002,39.97274600000003],[116.31905200000006,39.97258000000005],[116.31919700000002,39.97224100000005],[116.31966900000008,39.97109300000005],[116.32001800000008,39.97023500000006],[116.32015700000012,39.96984900000007],[116.32072000000008,39.96847600000007],[116.320828,39.968261000000034],[116.32090300000004,39.96810600000003],[116.321273,39.967135000000034],[116.32141199999998,39.96675900000002],[116.32167500000004,39.96615300000007],[116.3220080000001,39.96528900000004],[116.32226500000002,39.96448500000003],[116.322356,39.96414100000004],[116.32242100000008,39.96382500000004],[116.32245800000008,39.96367500000007],[116.32251700000003,39.963251000000064],[116.32274300000007,39.96159300000005],[116.32288200000006,39.96063800000008],[116.322941,39.960241000000046],[116.32294600000012,39.96019300000007],[116.32315000000006,39.95887900000003],[116.32324100000004,39.95822400000003],[116.32325800000002,39.95811200000002],[116.323349,39.95727500000003],[116.32338100000004,39.95701200000008],[116.32340300000008,39.95685600000007],[116.32341300000004,39.95678100000004],[116.32344,39.95657200000005],[116.3234940000001,39.95618000000008],[116.32367600000008,39.95492000000007],[116.32373500000006,39.95452300000005],[116.32383700000004,39.95368100000008],[116.3238910000001,39.95332100000008],[116.323934,39.95269400000007],[116.32398700000007,39.95205500000002],[116.32403000000008,39.95175500000004],[116.32405100000004,39.95161000000008],[116.32419600000004,39.951621000000046],[116.32486200000004,39.951648000000034],[116.32530100000008,39.95166900000003],[116.32557000000008,39.95168000000007],[116.32607400000003,39.95170100000007],[116.32657800000004,39.95173300000005],[116.32677100000002,39.95174400000008],[116.32685200000004,39.95175000000006],[116.32772600000008,39.95179800000006],[116.32785500000011,39.95180800000002],[116.32852,39.951846000000046],[116.3286760000001,39.95185700000008],[116.3289010000001,39.95186800000005],[116.32896500000004,39.95187300000004],[116.32929300000002,39.95188900000005],[116.33004900000005,39.951932000000056],[116.3308700000001,39.95197500000005],[116.33193200000002,39.95203900000007],[116.33238300000004,39.95206600000005],[116.333429,39.95212500000009],[116.3347050000001,39.95219500000008],[116.334963,39.95220500000005],[116.33591199999998,39.95224800000005],[116.33598700000005,39.95202800000004],[116.33617000000004,39.95160500000002],[116.33641100000013,39.95109500000007],[116.33659400000008,39.950784000000056],[116.33678100000007,39.95050500000007],[116.33709800000008,39.95011900000003],[116.337441,39.94981800000005],[116.33757000000004,39.949636000000055],[116.33786500000006,39.94942100000003],[116.33819200000003,39.94920700000006],[116.33868000000008,39.94892200000004],[116.34002100000008,39.94818200000004],[116.34067600000002,39.94781200000006],[116.34085300000002,39.94771000000002],[116.341674,39.94724300000007],[116.34218300000008,39.94699600000007],[116.342655,39.94678700000003],[116.34281600000008,39.946728000000064],[116.34309500000003,39.946605000000034],[116.34354100000004,39.94641700000005],[116.34385700000009,39.94628800000004],[116.344367,39.94607900000006],[116.34521400000004,39.945790000000045],[116.34745100000006,39.945065000000056],[116.34827700000002,39.94479200000007],[116.34883000000002,39.94456600000007],[116.34952700000004,39.944357000000025],[116.34982200000002,39.944271000000064],[116.35042300000008,39.94407300000006],[116.35059500000008,39.94399300000003],[116.35079900000004,39.94386900000006],[116.35098100000005,39.94373000000007],[116.35109900000006,39.94362200000006],[116.351265,39.94342400000005],[116.35130300000004,39.94336000000004],[116.35142100000007,39.94310200000007],[116.35147500000004,39.94296300000008],[116.35153900000012,39.94278500000007],[116.35159300000012,39.94252800000004],[116.35159800000008,39.94249000000008],[116.35162499999996,39.94232400000004],[116.35196300000008,39.94053200000008],[116.35199500000007,39.94039800000007],[116.35206500000004,39.93996900000007],[116.35208100000013,39.93984600000005],[116.35217700000008,39.93935800000002],[116.352199,39.93924000000004],[116.35232800000004,39.93861700000007],[116.35242400000004,39.93826900000005],[116.35258000000012,39.93782300000003],[116.35267600000007,39.93755000000005],[116.35273500000008,39.93754500000006],[116.35287500000004,39.936847000000064],[116.35292300000005,39.936702000000025],[116.35302000000004,39.93643400000008],[116.353159,39.93586500000004],[116.35321300000008,39.93566700000008],[116.35327700000003,39.93531800000006],[116.35327700000003,39.93530200000003],[116.35330400000008,39.93514100000004],[116.35334100000011,39.93493200000005],[116.35336800000005,39.93471700000004],[116.35341100000004,39.93419700000004],[116.353427,39.93402000000003],[116.35343300000012,39.93393400000008],[116.35344900000008,39.93313500000005],[116.35345400000006,39.93271600000003],[116.3534430000001,39.93264700000003],[116.35340600000008,39.93256600000006],[116.35385100000008,39.93255000000004],[116.353969,39.93251300000003],[116.35403900000006,39.93247000000007],[116.35461300000009,39.93247000000007],[116.35490200000004,39.93247500000006],[116.35508000000004,39.93247500000006],[116.35528300000009,39.93247500000006],[116.35562100000004,39.932480000000055],[116.35609900000009,39.93223900000004],[116.35612000000005,39.931917000000055],[116.35615200000008,39.93103700000006],[116.35619500000006,39.92991600000005],[116.35616300000004,39.92985200000004],[116.35612000000005,39.92950300000007],[116.35610400000007,39.92945500000008],[116.3560450000001,39.929401000000034],[116.35608800000011,39.92891800000007],[116.35613600000008,39.92761000000008],[116.35615200000008,39.92663300000004],[116.356174,39.92624200000005],[116.35620100000006,39.92559300000004],[116.35624300000006,39.92468100000008],[116.35626000000003,39.924316000000026],[116.35632900000007,39.92268500000006],[116.35636700000008,39.92178900000005],[116.35637800000003,39.92159600000007],[116.35641500000008,39.92110800000007],[116.35643100000004,39.92051200000003],[116.35646900000008,39.91965400000004],[116.35654400000008,39.91801800000007],[116.35662400000002,39.916124000000025],[116.356753,39.91333000000002],[116.35678000000006,39.91256800000008],[116.35678000000006,39.91200500000008],[116.35673200000006,39.91144600000007],[116.3566350000001,39.91066300000005],[116.35661400000004,39.910518000000025],[116.35651200000008,39.90945100000004],[116.3564960000001,39.90899500000005],[116.35651200000008,39.90853900000008],[116.356533,39.90808300000003],[116.35661900000002,39.90616800000005],[116.35663000000012,39.905986000000034],[116.35673200000006,39.90430600000007],[116.35673700000008,39.903738000000025],[116.356753,39.90352900000004],[116.35676900000009,39.90317500000003],[116.35678000000006,39.90282600000005],[116.35688200000004,39.902552000000064],[116.35693500000004,39.90234300000003],[116.356941,39.90233200000006],[116.35700500000009,39.90214500000008],[116.35709600000008,39.90195700000003],[116.35717700000008,39.90182800000008],[116.35740800000004,39.901512000000025],[116.35773000000007,39.901104000000025],[116.3579920000001,39.900788000000034],[116.35813700000006,39.90063200000003],[116.35844300000008,39.90035800000004],[116.35864100000003,39.90021900000005],[116.35903800000006,39.89997200000005],[116.35926900000004,39.89985400000006],[116.35984800000004,39.89962900000007],[116.36009,39.89956400000006],[116.36039600000002,39.89950000000004],[116.36072800000012,39.89946800000007],[116.36084600000004,39.89944600000007],[116.3609160000001,39.89941400000003],[116.36296500000005,39.89947300000005],[116.3632980000001,39.89948400000003],[116.3634320000001,39.89924300000007],[116.36342600000012,39.89903900000006],[116.36342600000012,39.89873300000005],[116.363421,39.898127000000045],[116.363421,39.89758500000004],[116.36343700000008,39.89696800000007],[116.36344300000006,39.896303000000046],[116.36331400000006,39.89633000000002],[116.36331400000006,39.89627600000005],[116.36331400000006,39.89606700000007],[116.36330800000006,39.89554600000002],[116.36331900000006,39.89461800000004],[116.36334600000008,39.89371700000004],[116.36335100000004,39.89358300000004],[116.36335100000004,39.893572000000056],[116.36337300000002,39.89310000000006],[116.36340000000008,39.89249400000005],[116.3634320000001,39.891550000000045],[116.36343700000008,39.89135700000002],[116.36344800000006,39.89108900000008],[116.363464,39.89050900000007],[116.36348500000004,39.88971500000007],[116.36349100000004,39.88950600000005],[116.36364600000005,39.88925400000004],[116.363909,39.88924900000006],[116.364585,39.88923800000003],[116.36533600000008,39.88923300000003],[116.36699900000008,39.88920600000005],[116.36718700000006,39.88920000000007],[116.36764300000004,39.88919500000003],[116.36787900000004,39.88919500000003],[116.36820100000013,39.88919500000003],[116.36920900000004,39.88920000000007],[116.36945600000004,39.88920000000007],[116.37003000000006,39.88920600000005],[116.37063100000012,39.88920600000005],[116.37118300000006,39.88920000000007],[116.3721760000001,39.889211000000046],[116.37277100000006,39.88905500000004],[116.37300200000006,39.88905000000005],[116.3736560000001,39.88906100000003],[116.37401600000008,39.88905000000005],[116.37416600000007,39.88900700000004],[116.37425200000008,39.88896400000005],[116.37427900000012,39.88850800000005],[116.3742840000001,39.888288000000045],[116.3743380000001,39.88681800000006],[116.37431100000003,39.88648100000005],[116.374316,39.88522500000005],[116.37432099999998,39.88436100000006],[116.374316,39.88411500000006],[116.37430500000004,39.88355100000007],[116.37449300000004,39.88354600000008],[116.37449300000004,39.88336900000008],[116.37449300000004,39.88324600000004],[116.37449300000004,39.882999000000034],[116.37449300000004,39.88223200000004],[116.37450400000012,39.88081000000005],[116.374499,39.88037000000002],[116.374499,39.88018300000005],[116.37450400000012,39.87959800000005],[116.3745090000001,39.87882600000006],[116.37450400000012,39.87863200000004],[116.374499,39.87856300000004],[116.37448300000004,39.87821900000006],[116.37447200000008,39.87788700000004],[116.374456,39.87692100000004],[116.37445000000002,39.875940000000064],[116.37445000000002,39.87569300000006],[116.37444500000004,39.87412600000005],[116.37445000000002,39.873316000000045],[116.37444000000006,39.87271000000004],[116.37443400000006,39.87234000000006],[116.37442300000008,39.87151400000005],[116.37442300000008,39.871128000000056],[116.37442300000008,39.87098300000008],[116.37456800000008,39.87098800000007],[116.37527600000011,39.87104200000004],[116.375931,39.87108500000005],[116.37658500000008,39.871128000000056],[116.37759400000002,39.871197000000045],[116.37860200000009,39.87127800000007]]
    onMounted(() => {
      window._AMapSecurityConfig = {
        securityJsCode: 'c4a180c973adc6a758a5bfaa4ed920d0',
      }

      AMapLoader.load({
        key: '0af83ad3683a68de9ffadc1ad63500d8', // 新的 key
        version: '2.0',
        plugins: ['AMap.MoveAnimation']

      })
      .then(AMap => {
        map = new AMap.Map('mapContainer', {
  center: [116.39, 39.9], // 天安门的经纬度
  zoom: 11 // 地图级别
})


        marker = new AMap.Marker({
          map: map,
          position: [116.3055280000001,39.98676300000005],
          icon: "https://a.amap.com/jsapi_demos/static/demo-center-v2/car.png",
          offset: new AMap.Pixel(-13, -26),
        })

        new AMap.Polyline({
          map: map,
          path: lineArr,
          showDir: true,
          strokeColor: "#28F",  //线颜色
          strokeWeight: 6,      //线宽
        })

        passedPolyline = new AMap.Polyline({
          map: map,
          strokeColor: "#AF5",  //线颜色
          strokeWeight: 6,      //线宽
        })

        marker.on('moving', function (e) {
          passedPolyline.setPath(e.passedPath)
          map.setCenter(e.target.getPosition(), true)
        })

        map.setFitView()
      })
      .catch(e => {
        console.error('地图加载失败:', e) // 加载错误提示
      })
    })

    const startAnimation = () => {
      marker.moveAlong(lineArr, {
        duration: 100,
        autoRotation: true,
      })
    }

    const pauseAnimation = () => {
      marker.pauseMove()
    }

    const resumeAnimation = () => {
      marker.resumeMove()
    }

    const stopAnimation = () => {
      marker.stopMove()
    }

    //以上为修改
    const checkInputs = () => {
      if (origin.value && destination.value) {
        showRoutes.value = true
      }
    }

    const startJourney = () => {
      console.log('出发地:', origin.value)
      console.log('目的地:', destination.value)
      console.log('选择的路线:', selectedRoute.value)
    }

    const minimizeRoutes = () => {
      showRoutes.value = false
    }

    const maximizeRoutes = () => {
      showRoutes.value = true
    }

    return {
      origin,
      destination,
      selectedTime,
      selectedRoute,
      showRoutes,
      checkInputs,
      startJourney,
      minimizeRoutes,
      maximizeRoutes,
      startAnimation,
      pauseAnimation,
      resumeAnimation,
      stopAnimation
    }
  }
}
</script>
<style scoped>
.map-container {
  width: 100%;
  height: calc(100vh - 60px); /* 确保地图容器有高度，减去导航栏高度 */
  margin-top: 0; /* 确保地图紧贴导航栏下方 */
  background-color: #f0f0f0; /* 添加背景色以便确认容器存在 */
}

.search-box {
  position: absolute;
  display: flex;
  align-items: center;
  background-color: white;
  border-radius: 5px;
  box-shadow: 0 2px 5px rgba(0, 0, 0, 0.15);
  padding: 5px 10px;
  z-index: 10; /* 确保搜索框在地图上方 */
}

.search-box .el-icon {
  color: #aaa;
  font-size: 18px;
  margin-left: 10px;
}

.search-box input::placeholder {
  color: #aaa;
}

.origin {
  top: 85px; /* 调整此值以确保搜索框在导航栏下方 */
  left: 20px;
}

.destination {
  top: 140px; /* 调整此值以确保搜索框在出发地搜索框下方 */
  left: 20px;
}

.time-selection {
  position: absolute;
  top: 200px; /* 调整此值以确保选择框在目的地搜索框下方 */
  left: 20px;
  display: flex;
  align-items: center;
  z-index: 10; /* 确保选择框在地图上方 */
}

.time-select {
  width: 120px; /* 墛大选择框的宽度 */
}

.routes-container {
  position: absolute;
  bottom: 20px; /* 固定在地图的左下角 */
  left: 20px;
  width: 300px; /* 固定宽度 */
  z-index: 10;
}

.route-card {
  width: 100%;
}

.route-options {
  display: flex;
  flex-direction: column;
}

.header-content {
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.minimized-button {
  font-size: 14px; /* 根据需要调整按钮大小 */
}

.input-card {
  position: absolute;
  bottom: 20px; /* 距离底部20px */
  right: 20px; /* 距离右侧20px */
  background-color: white; /* 白色背景 */
  border-radius: 5px; /* 圆角 */
  box-shadow: 0 2px 5px rgba(0, 0, 0, 0.15); /* 阴影 */
  padding: 20px; /* 内边距 */
  z-index: 10; /* 确保在地图上方显示 */
}
</style>